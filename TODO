
1. Look in kdegraphics/kolourpaint/BUGS
2. Look in kdegraphics/kolourpaint/patches/
3. grep all files (not just .cpp and .h) for:
   "COMPAT" - Signifies either:
              a) KDE 4 port breakage
              b) Considerations for backports to other KDE versions
   "CONFIG" - something that maybe should be configurable (either via GUI
              or by editing config file directly)
   "HACK" - ugly piece of code that _really_ should be done better
   "KDE3" - something we need to backport to the KDE 3 branch
   "OPT" - something that could be optimised
   "PROPAGATE" - an update that should be sent to other KolourPaint processes
                 using an IPC mechanism (e.g. DBUS for KDE 4, DCOP for KDE 3)
   "REFACTOR" - bad design or coding style that should be fixed
   "sync" - check dependencies between code when modifying
            e.g. "sync: kpView::paintEvent()" means synchronize changes with
            the corresponding "sync" in "kpView::paintEvent()".
   "SYNC" - check this is still valid before _every_ KolourPaint or KDE or
            Qt release - if this is regarding a hack around a library bug,
            test if that hack still works and if it does, it's probably safer
            than removing that hack esp. in the stable branch of KDE
   "STRING" - a string that should be added after a string freeze
   "TODO" - something that should be done but can be delayed indefinitely;
            some TODO's should really be LOTODO's or HITODO's

    These strings may be prefixed with "LO" if probably no one will care
    e.g. "LOTODO: Maybe the shade of green should be darker?".  Or with
    "HI" if they _really_ should be done ASAP by the.g. "HITODO: This is likely
    to crash".

4. See below:


4.1. Docs
4.2. Future Binary Releases
4.3. KDE
4.4. KolourPaint Code
4.5. Minor KolourPaint Code Ideas


4.1. Docs
~~~~~~~~~

In the "Notes" section of the Handbook, change the second paragraph to avoid
using "However ...".  [Thurston]

Rename fill_style.png and line_width.png to use the plural form for consistency
with brush_shapes, eraser_shapes, spraycan_patterns and
selections_opaque_transparent.  [Thurston]


4.2. Future Binary Releases
~~~~~~~~~~~~~~~~~~~~~~~~~~~

KolourPaint bin:
- install in menu (Lutz Schweizer)
- install_systemwide script as sent to: (Lutz Schweizer)
- "By the way, to run the program I need only a single click on the script
   file" [rather than the instruction about double-clicking] (Lutz Schweizer)
- how about make bin first, then RPM that to fix KDE /usr or /opt/kde3 issues
- docs for bin dist not work on debian - suspect different path and need better use of kde-config --docprefix or something

audit docs for refer to common:/ e.g. kde-default.css

QT_HAVE_MAX_IMAGE_SIZE // An extension made by SUSE to Qt :-(((
QImage::maxImageSize(); defaults to 4096 as max width and height could cause trouble

rename kolourpaint-1.4pre/kolourpaint to kolourpaint-1.4pre/src (there was
a reason why this wasn't done but I forgot - document this time)

unix2dos text files in all non-KDE releases to not give bad MS notepad impression


4.3. KDE
~~~~~~~~

re-enable the ICO write support

multicolumn KToolBar's (Bug #3)

fix edit/paste may disappear due to klipper - Bug #85456


4.4. KolourPaint Code
~~~~~~~~~~~~~~~~~~~~~

In light of crash Bug 117866, check that all timers are killed before e.g. adding
a command to the command history.

Less technical people do not know the difference between "PNG", "JPG" and
"FormatIMadeUp".  Have some sort of interface for them (e.g. "Large, Perfect Quality"
for "PNG" and "Small, Low Quality" for "JPG") [See Bug 104228]

The current are-you-sure-you-want-to-save-in-a-lossy-format dialog should
have a way to select another format directly.


CTRL+PgUp/Down scrolls (statusbar on PgUp/Down)

Geiser is right - if mainView->setzoom, mainWindow should know about it

Edit / Paste changes to Edit / Paste Text when text since CTRL+PrintScreen
seems to be so unreliable


[kpScrollableView rewrite]
Antonio Bianco
- split views
fix flicker when zooming in/out (Bug #1)
- maybe don't allow QScrollview to do own logic - would also eliminate
  tearing when scrolling with wheel (and of course, drag scrolling)



Hogne Titlestad:
- "Would also be nice to have a keyboard shortcut to traverse through the
   palette. If I say have a palette with 16 greys, 16 reds, 16 blues etc
   then moving to the next/previous palette item with keys would be a
   great help, when thinking about pixelling techniques. When painting
   grey, then wanting to shade manually, clicking CRTL+UPKEY or DOWNKEY or
   another combo to go to the next/prev grey color ( lighter/darker ). ( In
   this scenario, the palette is ordered so the colours are stacked by
   shade, from black to white etc, black to red to white etc, then the
   currently selected color would have a red box around it, and that red
   box could be moved with a keyboard shortcut, up and down, left and
   right? )."

Emmeran Seehuber (relevant to above impl):
"
> Problem is: there is no concept of a "current colour" in mspaint (relative
> to the palette) but rather "foreground" and "background" colours.  So I
> don't know how this would work exactly?

  You could apply the following strategie:
- You have current background and a current forground color. The following is
for the foreground color, but for thebackground colors it would be the same,
just other shortcuts.
- If the current foreground color matches a color of the palette, then you
know your position in the palette. From there go one color forward or
backward.
- If the current foreground color doesn't match a color, then just use the
last selected color in the palette. If no color is selected, then start at
index 0. From there go one color forward or backward.
"

Hogne Titlestad:
- generate gradient between 2 colours in palette



text tool when click creating should use last size?

text tool could autoresize if font size changes or paste text (Bug #11)
- maybe text selection could hold "userSetSize" as distinct from current size
  to allow e.g. auto increase box size for new font size, but then user changes
  mind and reverts to previous font size and the box snaps back
  (or only allow expand on writing text - no font size tricks etc.)



text toolbar permanently floats to stop view from bobbing up/down, when the
toolbar redocks:

diff -ur -x'Makefile.rules*' -x'Makefile.calls*' -xMakefile.in -x'*.o' -x'*.moc' -x'*.lo' -x.deps -x.libs -xkolourpaint -xk -x'TODO*' -xMakefile -x'*.la' -x'*~' -x'*.txt' -xh -x'*.swp' -Npd -xkolourpaintlicense.h kolourpaint-pris/kpmainwindow.cpp kolourpaint/kpmainwindow.cpp
--- kolourpaint-pris/kpmainwindow.cpp  2005-02-02 16:35:20.000000000 +1100
+++ kolourpaint/kpmainwindow.cpp 2005-02-01 14:02:46.000000000 +1100
@@ -29,6 +29,7 @@
 #include <kpmainwindow.h>
 #include <kpmainwindow_p.h>

+#include <qdockarea.h>
 #include <qdragobject.h>
 #include <qpainter.h>
 #include <qtimer.h>
@@ -248,6 +249,15 @@ void kpMainWindow::init ()
     // create more GUI
     //

+    // Prevent text toolbar from docking - it's _really_ irritating
+    // otherwise since causes view to move down to fit toolbar on even
+    // reasonably sized screens
+    moveDockWindow (textToolBar (), Qt::DockTornOff);
+    leftDock ()->setAcceptDockWindow (textToolBar (), false);
+    rightDock ()->setAcceptDockWindow (textToolBar (), false);
+    topDock ()->setAcceptDockWindow (textToolBar (), false);
+    bottomDock ()->setAcceptDockWindow (textToolBar (), false);
+
     m_colorToolBar = new kpColorToolBar (this, "Color Box");
 #if DEBUG_KP_MAIN_WINDOW
     kdDebug () << "\tTIME: new kpColorToolBar = " << time.restart () << "msec" << endl;

This probably works for Qt3 but not Qt4.



tests/kolourcircles.cpp; rendering glitches at 37% with rect sel tool


kptoolpreviewdialog: incorrect preview for a selection, if new pixels result in
                     different selection transparency

- Smooth with hotkey (blur painting, not smudge) (Hogne Titlestad+Antonio Bianco)
- "Lighten/Darken tool, even without antialiasing. Works *wonders* when
   making gfx. Combined with a smooth/blur tool amazing results can be
   achieved ;)  I don't think this would be hard to implement at all,
   perhaps as an option for the Pen.  Darkening with the right mouse button
   and lightening with the left.  Then blurring here and there to make
   smooth highlights." (Hogne Titlestad)

blur & sharpen tools



arbitrary tool sizes (Mikhail Capone)

2. Remember the last used brush sizes - in order to have room for this,
remove some of the current fixed brush sizes.?

- and + for arbitrary shape/brush size



Jonathan Turner - userinstinct:
- "Tried to email image
  Had to save first, did not like that"
Had a discussion with the Chief Investigator:
If you don't save the image:
1. what format will it be in (a huge BMP?  Or arbitrarily chosen JPG?)
2. what name will it have?  0045_temp-user.png?
3. why wouldn't you want a copy of an image you send to someone?  Yes, it's in your "Sent Items" but...
Suggestion: Export instead of save.  But what if really want to save?  Would have to prompt, save, then invoke Mail again - a bit round about.
What do other programs do?  KOffice?

Need to change grid to a non-solid color pattern so that at 400%, it doesn't
look like part of the image!


resize doc or sel freehand - usershapepoints should be (after string freeze):
"oldX x oldY - newX x newY  |||  (+|-)deltaX x (+|-)deltaY"
instead of
"oldX , oldY - newX , newY  |||  (-)deltaX x (-)deltaY"
(the "+" is to show that it's a delta, not a size; on 2nd thoughts, if
they're both -, it would be ambiguous)


Emmeran Seehuber:
"
Shortcut Key to move within the content if the scrollbar is visible (like KWin
ALT+LeftMouse to move windows) (e.g. holding the alreay taken M shortcut
would set the mouse cursor to a move cursor. Now pressing left mouse and
moving the mouse cursor would scroll the content of the window)
Up/Left/Down/Right to move within window content
Goto next/prev color in palete
"

* Mike on Sunday 29/Feb/2004, @10:54:
  - A "Hand" tool which activates by keeping the "Space" key pressed
    down to scroll the visible part of the image around just like
    in Acrobat or Photoshop.


* picture effect - simple effect missing - blur, sharpen,
  Hue, saturation,... [Later: as a freehand tool?]
  (mracek who is at the domain xko period or dot cz)


[KDE3] Sel border should not be xored against uninitialised rgb values
       (transparent pixels).  A testcase is to:

       1. Open an image with transparent pixels
       2. Press CTRL+A to look at an XOR border
       3. Fill the transparent pixels with any color to initialize the
          RGB values
       4. Fill those pixels so that they are transparent again
       5. Press CTRL+A to look at an XOR border and compare with 2.


* kpsqueezedtextlabel could use (or be replaced by) KStringHandler::rPixelSqueeze()

a better set of cursors that don't obscure the pixel you're drawing at
(e.g. compare the excellent Brush cursor to the Line Tool's cursor)

Lutz Schweizer:
"
> On a related note, I'm planning a new cursor for the pen: it will be like
> the cursor currently used for the brush tool.  What you prefer that or the
> current arrow cursor?

frankly, I would prefer the current arrow cursor for the "pen". If someone
prefers a cross (with thin lines), he may even now use the brush with the
"1x1" option; isn't that practically equivalent?
"


Bela-Andreas Bargel:
- add a "info-button" (or menu-entry) which
  shows all (meta-)data about the image (eg. to set its
  dpi-resolution, its size, jpg/png-comments, colour
  mode, used colours, file size,EXIF-data...)
Bart Symons
- "Image" -> "Properties"

[we now have "File / Properties..." but it lacks many of the above]



[I think I fixed this is KSelectAction - KDE 4]
Jonathan Turner - userinstinct:
- "Zoom indicator did not work properly";
  Can't reproduce, problem is probably: you can enter a new zoom and not
  press enter and continue painting - should reset to old zoom, maybe
  add tooltip to say press enter?




Edit/Find a particular colour



Emmeran Seehuber:
"
> The Escape-key
> could exit the input text mode [without deselecting the text box], so
> that the other tools would be available
> again.
"


keyboard friendly scrollview




Use kipiplugins' "sendimages" plugin instead of homebrew File / Mail...
(which has limitations like not being able to select format, must save
first etc.).


"Universal Selections" modify selections after selecting


RMB colour select & draw, holding shift are not discoverable.
SHIFT, CTRL modifiers are not discoverable - show tooltip or something



"I did discover the color picker applet, which I think is dead handy
(over kcolorchooser or kolourpaint's picker which is constrained to
the kolourpaint window"
(Adriaan de Groot - http://people.fruitsalad.org/adridg/bobulate/)

easy resize tool for text (instead of trying to grab corners)



add a key to show/hide all panels (toolbar, toolbox, palette box) giving a
semi fullscreen mode (Antonio Bianco)

allow user to hide Tool Box & Colour Palette if they really insist (it is
possible to ALT+F4 them and can't get them back!)



when in the palette editor window, clicking on the image selects the color
and show it in the palette editor, as active one : changing it, results in
a real time changing to the image - non-modal
(Antonio Bianco)

snap-grid. If you dont know what I mean, you could have a look
at XPaint [or PPaint/DPaint on any Amiga ;-) ]: You can give a x and y
value and get a "magnetic grid" where the brush "snaps in"
magnetic snap-grid
it would also be great for tiling an image!
> have any suggestions on what the UI will be like?
I always used paint-programs with the same kind of UI: One vertical bar
with the most used tools on the left (and sometimes on the right) side.
Left Click for using the tool and right click for configuring. This
leaves much place on the screen for the picture (another reason why I
like kolourpaint). If you would use the "right click" on a tool the
same way even the palette would fit on this bar.
(Michael Hoehne)

I noticed a bug in the text tool. I have the subpixel hinting
turned on but I suppose this should not be used in kolourpaint since
it only works on LCD displays. never use subpixel hinting even if
it is enabled globally. If you draw text in KolourPaint on a subpixel
hinting KDE on LCD, save the file and then view it on a CRT, bad.
(Amir Michail)



checkerboard static in thumbnail but moves with doc in mainview - make it
static in all places so that it's clear it's not part of the doc


componentisation (Eric Laffoon, Sebastian Laout/BasKet)

DBUS scriptable




Rethink kpView/kpViewManager design because of:
- performance
- problems with the image "sparkling" at zoom levels % 100 != 0
Ideas:
- time-based renderer (like in games)
- do something about this horrible tempImage hack (so slooooow)
- resize handles overlap text at 100% zoom; overlapping selected doesn't
  help; could show selection border outside of view in scrollview empty
  area (if selection is really to right and/or bottom); solid 1-width
  border in thumbnail for selection
Bug #6: modified states incorrectly set
- what undo/redo should do in middle of polyline?
- what about being unable to redo since did another op?

- maybe borders (e.g. selection borders) should always have a view width of 1
  - try currently editing a B&W icon to see what I mean (selection borders
    have a document width of 1 so the borders are magnified with zoom)

eraser cursor border should not get magnified


Image menu items as ordinary tools - e.g. freehand rotate would be nice
realtime "clock" that shows angle and direction for rotate
kptoolpreviewdialog shows checkerboard



"brushes / stamps, hopefully configured from an external source.
 I.e. not only slanted lines and points of multiple thickness, but
 arbitrary images." - Dirk Sch�berger
I want to avoid making the widgets too complicated but this sounds
like a very neat feature.

Bug 89145: wish: rouded rect with round corners (options for corners that
don't stretch with rect + radius)

http://dot.kde.org/1078028599/:
* Anonymous on Sunday 29/Feb/2004, @09:15:
  - Free definable sizes for line thickness/spraycan/color eraser,
    line styles (dashed, dotted, ...),
    fill patterns, chooseable brushes

dashed lines (David Ling)
- check old commits

kptoolwidgetbase - spacing between items, make contentsRect() actual size wanted


rotate floating point (Christoph Eckert)



Bela-Andreas Bargel:
- acquire from kamera


scaling image with sel (with no content), and then manip sel adds extra "Selection: Create"
(this is a rather difficult problem to fix since sel has already been used
 for Image/Scale so would be inapproriate to replace it in cmd history)




view/preview OR view/fullscreen (not the same as settings/fullscreen)

AUDIT: use of QPoint () or QPoint (-1, -1) as a sentinel is worrying since
       it's a legal point when dragging out a rectangle

tool box icons should have same background color as the other controls

* kpSelection::setPixmap (QPixmap ()) hack allegedly for saving memory in commands
  backfires:
  - implicit sharing means that (most of the time), this isn't true
  - it forces kpSelection::calculateTransparencyMask() sloooowing things down

  - but then what about kpCommand::size()?


config dialogs (look into new kconfig generator)
- visual transparency background
checkerboard + grid doesn't mix at certain zoom levels

bug: draw rectangle, drag out selection, undo - kills rect but not selection
is this a feature?

kpViewManager::setTextCursorBlinkState() needs to restart timer



better graphics backend
- screen depth independent (Bug 85280)
  + 8-bit palette images (Antonio Bianco)
- supports alpha (Hogne Titlestad, Luke-Jr:Bug94607)
- option for antialiasing tools (Stefan Taferner, Mikhail Capone, Antonio Bianco)


in the "more effects" windows add "saturation" [done], "highlights" and "shadows"
(Antonio Bianco)

in the "image" menu add a "fade latest effect" voice, that if selected
brings up a slider that fades the image before with the image after the
effect : this allows fine adjustements, and it's really useful;
(Antonio Bianco)


intersect bounding rect with document rect when saving undo info
- e.g. if you drag out a large rectangle bigger than the view, it wastes a lot of memory
on undo

Bug: dragging a line extending outside of doc makes the doc transparent (RGB_A_ for PNG saves)
Hypothesis: kpPixmapFX::getPixmapAt() defines undefined pixels as transparent


with a 2 colour image, save as monochrome - ok
but then add a colour and then save - it's drastically different -
all black & white (and just all black if not dither); need better
monochrome dither than Qt

reduce to a custom number of colours like IrfanView (Christoph Eckert)


fill - can optimise mem usage by deleting kpFloodFill object
       when execute() (don't derive object)
     - can optimise mem usage by detecting single colour fills


Bug 92150: view tiffs with more than one page (+Christoph Eckert)
- animation/film strip (Hogne Titlestad)

Bug 86509: Multiple layers when editing image
(1-bit transparency only)
+Dennis Pennekamp


Stephan Unknown
- KIPI support
"a simple plugins framework that allows plugins to be written in various
languages (C, Python and Perl being the obvious choices) to allow people to
extend it into the realms of PaintShop Pro without impacting on the core
philosophy of the app, which seems to be simplicity." -- Tom

improve contrast quality

Brad Grant:
- red-eye removal (see QImage for windows and LPhoto from Lindows (Bela-Andreas))
Bela-Andreas Bargel:
- (LPhoto from Lindows): red-eye removal, enhance image


config flaws:
- interprocess config propagation (grep for PROPAGATE) - surely this can be
  done easily without KUniqueApplication or DCOP?

config dialogs (look into new kconfig generator)
- recent files history length
- undo limit
- grid tiling
- saving transparency background
  (for formats like BMP which don't suport transparency)
- Un-DoNotAskAgain

tool/ruler (can even measure length & angle of diagonal lines)

Bela-Andreas Bargel:
- greyscale masks

selections
- should be able to use selection/image commands on text box

* Mike on Sunday 29/Feb/2004, @10:54:
  - If that's the case then also on my wishlist for the next version:
    Automatic command line calling of ImageMagick to convert from png to gif
    so the user doesn't even notice there is no GIF support compiled in.
    No ImageMagick-dependency is needed - just call "convert" via exec.

    I know that most people hate GIF but as a web developer PNGs aren't a
    solution yet because of their awful buggy support in IE.
mracek who is at the domain xko period or dot cz:
* fileformat - missing gif

http://dot.kde.org/1078028599/:
* Anonymous on Sunday 29/Feb/2004, @09:15 (+Ismail Belhachmi):
  - GIMP style rulers



4.5. Minor KolourPaint Code Ideas
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

KolourPaint at >= 1.0 should be very usable.  So the following are just nice
ideas (or things I should really do :)) that may or may not ever get
implemented:


also don't store ptrs to e.g. kpDocument as they may go out of date

kdError -> KP_PANIC or KMessageBox
wait cursor for slow ops - should it be in kpDocument or in the commands???

ability to specify measurements in pt,mm,cm,m,in instead of just pixels

grid for zoom levels > 200 but % 100 != 0

maybe allow editing when a selection is active (selection becomes bounding rect)

offer to save Undo/Redo QPixmap's as PNGs to save memory

colour palette shows frequently used colours for the current image

readonly mode

network friendly - async save

line: shift+alt doesn't work but alt+shift does
- doesn't look like Bug #64019
- alt alone is backfiring anyway (conflicts with kwin)
  so I'll just leave 30deg & 60deg lines as hidden functionality for now
  (until I can think up a better key combo/way to activate it)

Colour Eraser as part of the Image Menu? You can dbl-click on the tool after all.

On open, dither (instead of the current "threshold" approach) alpha channel to mask?

Open 800x600 image, Skew, set horizontal to 60, vertical to 30 and play with
vertical and the image flips over!  I'm sure that's not supposed to happen.
Needs investigating.

Brad Grant:
- rotating a JPG losslessly
- resampling a picture to enlarge it with quality choices (bilinear,
  bicubic, lanczos, ...)

Christoph Eckert:
shape selections should support CTRL, ALT, SHIFT to alter shape but
ATM, CTRL means copy, SHIFT means sweep.

[KDE3] if you undock a vertical toolbar and right click --> Orientation --> Bottom,
       it stays vertically oriented


Bela-Andreas Bargel:
- extra toolbar with slideshow and other image viewing options

Christoph Eckert:
- Icons could be rearranged; drawing and editing tools should
  be grouped together instead of being spread over the toolbox

kde-apps.org:
* posthuman  on: 02/28/2004, 15:50
  - GIMP stuff like Crop Images and the intelligent scissor and a couple of more stuff.

Dirk Sch�berger
> I stumbled about yet another (end user) paint program. I cannot stand its
> GUI, but its user manual seems to fit on on HTML page.
> Perhaps you can find some ideas for features for future KolourPaint
> versions.
>
> http://www.simugraph.com/drops/

Antonio Bianco
- other programs DeluxePaint, grafx2, promotion, artgem, photofiltre

Hogne Titlestad:
- http://www.squirreldome.com/

Enrico Ceppi:
- add a Selection working as Polygon
- add a "Paste inte selection" or a "Paste into color" (to overwrite an
arbitrary area)

mracek who is at the domain xko period or dot cz:
* filler - cannot edit scale to fill
Example: win app fotocanvas 1.1 trial (acdseesystems) - it
is good, but no transparent, no paint, only changing photo
(picture).

kpMainWindow::slotEnablePaste() is slow due to kpSelection::canDecode()
- QMimeSource::provides() sucks up most of the CPU (sometimes 4s),
  while QImageDrag::canDecode() usually takes up to 250ms.
- Trigger this by holding down CTRL+Printscreen
- best we can do is execute this check once per process (instead of per
  mainwWindow) and update all the mainWindows

draw rectangle and land on doc resize handle - wrong status mess
- that's a problem with Qt not giving EnterEvents when the mouse move is
  initiated from another object (see kpViewManager::viewUnderCursor() for
  the same problem)

Bart Symons
- "Edit" -> "Duplicate current image" (opens up another Kolourpaint instance
with a duplicate of the current image)

Emmeran Seehuber:
"
P.S.: Kolourpaint feels a little bit Deluxe Paint / Personal Paint (both are
Amiga programs) like. A toolbar option/checkbox like "Instant float
selection" would make this perfect. When activated, performing a selection
would instant copy the selection as "brush" and would float the brush under
the mouse pointer. When you press left mouse the brush would just be painted
into the picture at the given position. This is very usefull to retouch
pictures.
"

can't copy 1600x1200 season.jpg double scaled from one kolourpaint to another
(Bug #20)

the resulting file doesn't get displayed in
Kolourpaint after saving (hey, this is not a complaint), and
undo is not possible this way. (Christoph Eckert)

menu opt to acquire screen captures since not all know about
CTRL+Ptrscreen. (Mikhail Capone)
- add ksnapshot mode to paste grabbed thing directly into kolourpaint so
  that kolourpaint gets a "Take screenshot" menu item
(Bela-Andreas Bargel)
